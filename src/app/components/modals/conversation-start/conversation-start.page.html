<div header padding20 flex center-ver *ngIf="pageLoaded&&!directStart">
  <div class="title">
    <h3 class="subtitle-top" noMargin>
      {{'conversation_start.the_case' | translate}}
      <span *ngIf="step!=4"> - </span>
      <span *ngIf="step==5&&caseItem.id">{{'conversation_start.starting' | translate}}</span>
    </h3>
  </div>
  <span class="spacer"></span>
  <ion-button (click)="modalCtrl.dismiss()" fill="clear" color="secondary">
    <fa-icon [icon]="icon.get('faTimes')" font-20 slot="icon-only"></fa-icon>
  </ion-button>
</div>


<div class="content" [ngStyle]="{'margin-bottom':media.smallDevice ? '0px' : '75px'}" *ngIf="pageLoaded&&!directStart">

  <div class="modalIntro" *ngIf="step==5&&caseItem.id">{{'conversation_start.starting_instructions' | translate}}</div>

  <ion-card basicPadding *ngIf="step==4" class="mainCard">

    <ion-card-content class="detailColumn">
      <ion-row>
          <ion-col size="12" noPadding>

 
            <div *ngIf="caseItem.previousConversationId" fullwidth marginBottom>
              <div weight600 font-18 [innerHtml]="translate.instant('conversation.days_between_conversations')"></div>
              <ion-input type="number" listCard labelPlacement="floating" [(ngModel)]="caseItem.daysBetweenConversations"></ion-input>
            </div>
            
            <div *ngIf="caseItem.previousConversationId" fullwidth marginBottom>
              <div weight600 font-18 [innerHtml]="translate.instant('conversation.actions_between_conversations')"></div>
              <ion-textarea rows="4" listCard labelPlacement="floating" [autoGrow]="true" [(ngModel)]="caseItem.actionsBetweenConversations"></ion-textarea>
            </div>

            <div *ngIf="caseItem.admin||caseItem.editable_by_user.free_answer && caseItem.free_question" fullwidth marginBottom>
              <div weight600 font-18 [innerHtml]="caseItem.free_question | sanitizeHtml"></div>
              <ion-textarea rows="4" listCard labelPlacement="floating" [autoGrow]="true" [(ngModel)]="caseItem.free_answer"></ion-textarea>
            </div>

            <div *ngIf="caseItem.admin||caseItem.editable_by_user.free_answer && caseItem.free_question2" fullwidth marginBottom>
              <div weight600 font-18 [innerHtml]="caseItem.free_question2 | sanitizeHtml"></div>
              <ion-textarea rows="4" listCard labelPlacement="floating" [autoGrow]="true" [(ngModel)]="caseItem.free_answer2"></ion-textarea>
            </div>

            <div *ngIf="caseItem.admin||caseItem.editable_by_user.free_answer && caseItem.free_question3" fullwidth marginBottom>
              <div weight600 font-18 [innerHtml]="caseItem.free_question3 | sanitizeHtml"></div>
              <ion-textarea rows="4" listCard labelPlacement="floating" [autoGrow]="true" [(ngModel)]="caseItem.free_answer3"></ion-textarea>
            </div>

            <div *ngIf="caseItem.admin||caseItem.editable_by_user.free_answer && caseItem.free_question4" fullwidth marginBottom>
              <div weight600 font-18 [innerHtml]="caseItem.free_question4 | sanitizeHtml"></div>
              <ion-textarea rows="4" listCard labelPlacement="floating" [autoGrow]="true" [(ngModel)]="caseItem.free_answer4"></ion-textarea>
            </div>

            <div *ngIf="(showGoal.free&&caseItem.goal&&caseItem.admin)||(caseItem.editable_by_user.goals.free&&!caseItem.admin)" fullwidth marginBottom>
              <div weight600 font-18 [innerHtml]="translate.instant('conversation_start.goal_instructions') | sanitizeHtml"></div>
              <ion-textarea rows="4" listCard labelPlacement="floating" [autoGrow]="true" [(ngModel)]="caseItem.goalsItems.free"></ion-textarea>
            </div>

          </ion-col>
        

      </ion-row>


    </ion-card-content>

  </ion-card>

  <ion-card basicPadding basicRadius *ngIf="step==5" class="mainCard">
    <ion-card-content>

      <div *ngIf="caseItem.admin||caseItem.editable_by_user.openingMessage" fullwidth marginBottom>
        <div *ngIf="caseItem.admin" weight600 font-18 [innerHtml]="translate.instant('conversation_start.opening') | sanitizeHtml"></div>
        <div *ngIf="!caseItem.admin" weight600 font-18 [innerHtml]="translate.instant('conversation_start.opening_user') | sanitizeHtml"></div>
        <ion-textarea rows="4" listCard labelPlacement="floating" [autoGrow]="true" [(ngModel)]="caseItem.openingMessage"></ion-textarea>
      </div>

      <div *ngIf="caseItem.admin||caseItem.voice" fullwidth marginBottom flex center-ver>
        <ion-toggle [(ngModel)]="caseItem.voice_on"></ion-toggle>
        <div weight600 marginLeft font-18 [innerHtml]="translate.instant('conversation_start.start_with_voice')" *ngIf="caseItem.voice_on"></div>
        <div weight600 marginLeft font-18 [innerHtml]="translate.instant('conversation_start.start_without_voice')" *ngIf="!caseItem.voice_on"></div>
      </div>

      <div *ngIf="caseItem.admin||(caseItem.voice && caseItem.editable_by_user.voice)" fullwidth marginBottom flex center-ver>
        <div weight600 marginLeft font-18 [innerHtml]="translate.instant('conversation_start.selected_voice')"></div>:
        <div class="spacer"></div>
        <ion-button color="secondary" (click)="selectVoice()" class="saveButton" fill="outline">{{caseItem.voice}}</ion-button>
      </div>

    </ion-card-content>

  </ion-card>

  <!-- <ion-card basicPadding basicRadius *ngIf="step==6&&caseItem.admin" class="mainCard">
    <ion-card-content>

      <div *ngFor="let editable of caseItem.editable_by_user | keyvalue">
        <ion-item detail="false" lines="none" listCard fullwidth *ngIf="editable.key!='goals'&&editable.key!='agents'&&editable.key!='max_time'">
          <ion-toggle noMargin [(ngModel)]="editable.value" color="primary" weight600>{{'case_options.editable_'+editable.key | translate}}</ion-toggle>
        </ion-item>
      </div>

      <ion-item detail="false" lines="none" listCard fullwidth>
        <ion-label position="stacked" >
          <h1 noMargin>Doelen</h1>
        </ion-label>
        <ion-toggle noMargin fullwidth [(ngModel)]="caseItem.editable_by_user.goals.attitude" color="primary">Houding van de gesprekspartner</ion-toggle>
        <ion-toggle noMargin fullwidth [(ngModel)]="caseItem.editable_by_user.goals.phases" color="primary">Niveau van de verschillende fases</ion-toggle>
        <ion-toggle noMargin fullwidth [(ngModel)]="caseItem.editable_by_user.goals.free" color="primary">Vrije tekst</ion-toggle>
      </ion-item>

      <ion-item detail="false" lines="none" listCard fullwidth>
        <ion-label position="stacked" >
          <h1 noMargin>Agents</h1>
        </ion-label>
        <ion-toggle noMargin fullwidth [(ngModel)]="caseItem.editable_by_user.agents.choices" color="primary">{{'case_options.agents_choices' | translate}}</ion-toggle>
        <ion-toggle noMargin fullwidth [(ngModel)]="caseItem.editable_by_user.agents.facts" color="primary">{{'case_options.agents_facts' | translate}}</ion-toggle>
        <ion-toggle noMargin fullwidth [(ngModel)]="caseItem.editable_by_user.agents.background" color="primary">{{'case_options.agents_background' | translate}}</ion-toggle>
        <ion-toggle noMargin fullwidth [(ngModel)]="caseItem.editable_by_user.agents.undo" color="primary">{{'case_options.agents_undo' | translate}}</ion-toggle>
      </ion-item>

    </ion-card-content>
    
              
  </ion-card> -->

</div>

<div class="buttons" *ngIf="pageLoaded&&!directStart">
  
  <div flex center-ver>
    <ion-button *ngIf="step!=0" color="secondary" class="saveButton" (click)="slide(step-1,true)" [disabled]="step==3&&!promptChecked">
      <span *ngIf="media.screenSize!='xs'">{{'buttons.back' | translate}}</span>
      <span *ngIf="media.screenSize=='xs'">
        <fa-icon [icon]="icon.get('faArrowLeft')" font-18></fa-icon>
      </span>
    </ion-button>

    <!-- <ion-button *ngIf="step==3" [disabled]="!promptChecked" color="tertiary" class="saveButton" (click)="rebuildPrompt()">
      <fa-icon *ngIf="promptChecked&&!changesMade()&&caseItem.casus" [icon]="icon.get('faRedoAlt')" slot="icon-only"></fa-icon>
      <span *ngIf="promptChecked&&!changesMade()&&!caseItem.casus">Casus genereren?</span>
      <ion-spinner color="secondary" *ngIf="!promptChecked&&!changesMade()"></ion-spinner>
      <span *ngIf="!promptChecked&&!changesMade()">Moment geduld</span>
      <span *ngIf="changesMade()&&media.screenSize!='xs'">De aanpassingen verwerken?</span>
      <span *ngIf="changesMade()&&media.screenSize=='xs'">Aanpassen?</span>
    </ion-button> -->

    <span class="spacer"></span>

    <ion-button *ngIf="step!=6&&caseItem.admin&&caseItem.id" color="success" class="saveButton" (click)="close()" [disabled]="step==3&&!promptChecked">
      <span *ngIf="media.screenSize!='xs'">{{'buttons.save' | translate}}</span>
      <span *ngIf="media.screenSize=='xs'">
        <fa-icon [icon]="icon.get('faSave')" font-18></fa-icon>
      </span>
    </ion-button>


    <ion-button *ngIf="step!=6&&!(step==5&&!caseItem.admin)" color="primary" class="saveButton" (click)="slide(step+1)" [disabled]="step==3&&!promptChecked">
      <span *ngIf="media.screenSize!='xs'">{{'buttons.next' | translate}}</span>
      <span *ngIf="media.screenSize=='xs'">
        <fa-icon [icon]="icon.get('faArrowRight')" font-18></fa-icon>
      </span>
    </ion-button>

    <!-- <ion-button *ngIf="step==6" color="success" class="saveButton" (click)="close()">
      <span *ngIf="media.screenSize!='xs'">{{'buttons.save' | translate}}</span>
      <span *ngIf="media.screenSize=='xs'">
        <fa-icon [icon]="icon.get('faCheck')" font-18></fa-icon>
      </span>
    </ion-button> -->

    <ion-button *ngIf="step==5&&!caseItem.admin" color="primary" class="saveButton" (click)="close()">
      <span *ngIf="media.screenSize!='xs'">{{'buttons.start' | translate}}</span>
      <span *ngIf="media.screenSize=='xs'">
        <fa-icon [icon]="icon.get('faCheck')" font-18></fa-icon>
      </span>
    </ion-button>

  </div>
</div>




























<!-- <div header padding20 flex center-ver>
  <div class="title">
    <h3 class="subtitle-top" noMargin>
      {{'conversation_start.the_case' | translate}} {{step}}
      <span *ngIf="step==5&&caseItem.id">{{'conversation_start.starting' | translate}}</span>
    </h3>
  </div>
  <span class="spacer"></span>
  <ion-button (click)="modalCtrl.dismiss()" fill="clear" color="secondary">
    <fa-icon [icon]="icon.get('faTimes')" font-20 slot="icon-only"></fa-icon>
  </ion-button>
</div>

<div class="content" [ngStyle]="{'margin-bottom':media.smallDevice ? '0px' : '75px'}">

  <div class="modalIntro" *ngIf="step==5&&caseItem.id">{{'conversation_start.starting_instructions' | translate}}</div>
  
  <ion-card basicPadding *ngIf="step==4" class="mainCard">

    <ion-card-content class="detailColumn">
      <ion-row>
          <ion-col size="12" noPadding>

            <div *ngIf="caseItem.admin||caseItem.editable_by_user.free_answer && caseItem.free_question" fullwidth marginBottom>
              <div weight600 font-18 [innerHtml]="caseItem.free_question | sanitizeHtml"></div>
              <ion-textarea rows="4" listCard labelPlacement="floating" [autoGrow]="true" [(ngModel)]="caseItem.free_answer"></ion-textarea>
            </div>

            <div *ngIf="caseItem.admin||caseItem.editable_by_user.free_answer && caseItem.free_question2" fullwidth marginBottom>
              <div weight600 font-18 [innerHtml]="caseItem.free_question2 | sanitizeHtml"></div>
              <ion-textarea rows="4" listCard labelPlacement="floating" [autoGrow]="true" [(ngModel)]="caseItem.free_answer2"></ion-textarea>
            </div>

            <div *ngIf="caseItem.admin||caseItem.editable_by_user.free_answer && caseItem.free_question3" fullwidth marginBottom>
              <div weight600 font-18 [innerHtml]="caseItem.free_question3 | sanitizeHtml"></div>
              <ion-textarea rows="4" listCard labelPlacement="floating" [autoGrow]="true" [(ngModel)]="caseItem.free_answer3"></ion-textarea>
            </div>

            <div *ngIf="caseItem.admin||caseItem.editable_by_user.free_answer && caseItem.free_question4" fullwidth marginBottom>
              <div weight600 font-18 [innerHtml]="caseItem.free_question4 | sanitizeHtml"></div>
              <ion-textarea rows="4" listCard labelPlacement="floating" [autoGrow]="true" [(ngModel)]="caseItem.free_answer4"></ion-textarea>
            </div>

            <div *ngIf="(showGoal.free&&caseItem.goal&&caseItem.admin)||(caseItem.editable_by_user.goals.free&&!caseItem.admin)" fullwidth marginBottom>
              <div weight600 font-18 [innerHtml]="translate.instant('conversation_start.goal_instructions') | sanitizeHtml"></div>
              <ion-textarea rows="4" listCard labelPlacement="floating" [autoGrow]="true" [(ngModel)]="caseItem.goalsItems.free"></ion-textarea>
            </div>

          </ion-col>
        

      </ion-row>


    </ion-card-content>

  </ion-card>

  <ion-card basicPadding basicRadius *ngIf="step==5" class="mainCard">
    <ion-card-content>

      <div *ngIf="caseItem.admin||caseItem.editable_by_user.openingMessage" fullwidth marginBottom>
        <div *ngIf="caseItem.admin" weight600 font-18 [innerHtml]="translate.instant('conversation_start.opening') | sanitizeHtml"></div>
        <div *ngIf="!caseItem.admin" weight600 font-18 [innerHtml]="translate.instant('conversation_start.opening_user') | sanitizeHtml"></div>
        <ion-textarea rows="4" listCard labelPlacement="floating" [autoGrow]="true" [(ngModel)]="caseItem.openingMessage"></ion-textarea>
      </div>
    </ion-card-content>

  </ion-card>

</div>
<div class="buttons">
  
  <div flex center-ver>
    <ion-button *ngIf="step!=0" color="secondary" class="saveButton" (click)="slide(step-1,true)" [disabled]="step==3&&!promptChecked">
      <span *ngIf="media.screenSize!='xs'">{{'buttons.back' | translate}}</span>
      <span *ngIf="media.screenSize=='xs'">
        <fa-icon [icon]="icon.get('faArrowLeft')" font-18></fa-icon>
      </span>
    </ion-button>

    <ion-button *ngIf="step==5&&!caseItem.admin" color="primary" class="saveButton" (click)="close()">
      <span *ngIf="media.screenSize!='xs'">{{'buttons.start' | translate}}</span>
      <span *ngIf="media.screenSize=='xs'">
        <fa-icon [icon]="icon.get('faCheck')" font-18></fa-icon>
      </span>
    </ion-button>

  </div>

</div> -->