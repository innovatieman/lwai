<app-header page="account"></app-header>
<main>
  <ion-grid>
    <ion-row *ngIf="media.smallDevice" style="height:52px;">
      <app-menu-mobile></app-menu-mobile>
    </ion-row>
    <ion-row>
      <ion-col *ngIf="!media.smallDevice" [size]="media.smallDevice ? 0 : 3" class="selectColumn" style="padding-top:15px;">


        <div *ngIf="!media.smallDevice">
          
          <div style="padding:10px 0px;border-radius:16px;margin-bottom:15px;" class="notActiveItem" >
  
            <ion-item detail="false" lines="none" button (click)="nav.go('start/dashboard')" class="itemButton" [detail]="false">
              <div font-20 weight700>{{'page_account.dashboard' | translate}}</div>
              <fa-icon font-24 titleIcon [slot]="'end'" [icon]="icon.get('faHome')"></fa-icon>
            </ion-item>
  
          </div>

          <div *ngFor="let item of menuItems" style="padding:10px 0px;border-radius:16px;margin-bottom:15px;" [ngClass]="{'activeItem':activeTab==item.tab,'notActiveItem':activeTab!=item.tab}">
  
            <ion-item detail="false" lines="none" button (click)="changeTab(item.tab)" class="itemButton" [detail]="false">
              <div font-20 weight700 >{{item.title}}</div>
              <fa-icon font-24 [slot]="'end'" [icon]="icon.get(item.icon)"></fa-icon>
            </ion-item>
  
          </div>
  
          <div style="padding:10px 0px;border-radius:16px;margin-bottom:15px;" class="notActiveItem" *ngIf="auth.customer?.stripeCustomerId">
  
            <ion-item detail="false" lines="none" button (click)="auth.openStripeDashboard()" class="itemButton" [detail]="false">
              <div font-20 weight700>{{'page_account.billing' | translate}}</div>
              <fa-icon font-18 slot="end" style="color:rgba(0,0,0,0.3)" [icon]="icon.get('faExternalLinkAlt')"></fa-icon>
              <fa-icon font-24 titleIcon [slot]="'end'" [icon]="icon.get('faCreditCard')"></fa-icon>
            </ion-item>
  
          </div>

        </div>



      </ion-col>

      <ion-col [size]="media.smallDevice ? 12 : 9" class="detailColumn" center-left>
        
        <ion-card basicPadding *ngIf="activeTab=='basics'">
          <ion-row>
            <ion-col size="12">
              <ion-card-header>
                <ion-card-title>{{'page_account.my_data' | translate}}</ion-card-title>
              </ion-card-header>
              <ion-card-content>
                <ion-list style="background:white;--background:white">
                  <ion-label position="stacked" style="margin-left:15px">{{'page_account.first_name' | translate}}</ion-label>
                  <ion-item detail="false" lines="none" class="fieldItem" style="--padding-start:0;">
                    <ion-input class="saveButton" borderRadius24 placeholder="Naam" type="text" [(ngModel)]="accountService.account.displayName"></ion-input>
                  </ion-item>
                </ion-list>
                <ion-button class="saveButton" [disabled]="!accountService.account.displayName || accountService.account.displayName == this.auth.userInfo.displayName" (click)="updateAccount()">{{'buttons.save' | translate}}</ion-button>
              </ion-card-content>
            </ion-col>
          </ion-row>
        </ion-card>

        <ion-card basicPadding *ngIf="activeTab=='basics'">
          <ion-row>
            <ion-col size="12">
              <ion-card-header>
                <ion-card-title>{{'page_account.location' | translate}}</ion-card-title>
              </ion-card-header>
              <ion-card-content>
                <ion-list style="background:white;--background:white">
                  <ion-label position="stacked" style="margin-left:15px">{{'languages.country' | translate}}</ion-label>
                  <ion-item detail="false" lines="none" class="fieldItem" style="--padding-start:0;" (click)="accountService.showCountryPicker()">
                    <div class="select">
                      <ion-thumbnail slot="start" *ngIf="auth.userInfo?.country" style="--size:30px;width:35px;height:25px;">
                        <img [src]="countries.country(auth.userInfo.country).flag">
                      </ion-thumbnail>
                      <div class="text" *ngIf="auth.userInfo?.country">{{countries.country(auth.userInfo.country).country}}</div>
                    </div>
                  </ion-item>

                  <ion-label position="stacked" style="margin-left:15px">{{'languages.language' | translate}}</ion-label>
                  <ion-item detail="false" lines="none" class="fieldItem" style="--padding-start:0;" (click)="accountService.editLang()">
                    <div class="select">
                      <fa-icon font-24 [icon]="icon.get('faGlobeEurope')" class="langIcon" ></fa-icon>
                      <div class="text">{{'languages.'+translate.currentLang | translate}}</div>
                    </div>
                  </ion-item>

                  <!-- <ion-label position="stacked" style="margin-left:15px">{{'currency.currency' | translate}}</ion-label>
                  <ion-item detail="false" lines="none" class="fieldItem" style="--padding-start:0;" (click)="editCurrency()">
                    <div class="select">
                      <div font-22 weight700 style="margin-right:20px;" *ngIf="auth.userInfo.currency">{{'currency.'+auth.userInfo.currency+'_symbol' | translate}}</div>
                      <div class="text" *ngIf="auth.userInfo.currency">{{'currency.'+auth.userInfo.currency | translate}}</div>
                    </div>
                  </ion-item> -->

                </ion-list>
              </ion-card-content>
            </ion-col>
          </ion-row>
        </ion-card>

        <ion-card basicPadding *ngIf="activeTab=='basics'">
          <ion-row>
            <ion-col size="12">
              <ion-card-header>
                <ion-card-title flex center-ver fullwidth>
                  <span>{{'page_account.preferences' | translate}}</span>
                  <div class="spacer"></div>
                  <ion-button class="saveButton" [disabled]="!filterEdited" (click)="accountService.updateFilter()">{{'buttons.save' | translate}}</ion-button>
                </ion-card-title>
              </ion-card-header>
              <ion-card-content style="max-height:600px;overflow-y:auto;">
                <p style="padding:0 15px">{{'page_account.preferences_text' | translate}}</p>
                <div *ngFor="let type of infoService.conversation_types | sortBy: -1 : 'order'">
                  <ion-item detail="false" lines="none" font-18 weight500 noMargin class="selectCaseItem" (click)="type.selected = !type.selected">
                      <ion-checkbox mode="md" slot="start" [(ngModel)]="type.selected" noPointerEvents></ion-checkbox>
                      <ion-label>{{ type[translate.currentLang] }}</ion-label>
                  </ion-item>
                  <div *ngIf="type.selected" class="innerSelectCase">
                      <ion-item detail="false" lines="none" font-18 weight400 noMargin class="selectCaseItem innerSelectCaseItem" *ngFor="let subject of type.subjects" (click)="subject.selected = !subject.selected">
                          <ion-checkbox mode="md" slot="start" [(ngModel)]="subject.selected" noPointerEvents></ion-checkbox>
                          <ion-label>{{ subject[translate.currentLang] }}</ion-label>
                      </ion-item>
                  </div>
                </div>
              </ion-card-content>
            </ion-col>
          </ion-row>
        </ion-card>

        <ion-card basicPadding pointer *ngIf="activeTab=='basics'" (click)="removeUser()">
          <ion-row>
            <ion-col size="12">
              <ion-card-header>
                <ion-card-title style="opacity:0.6">{{'page_account.remove_account' | translate}}</ion-card-title>
              </ion-card-header>
            </ion-col>
          </ion-row>
        </ion-card>

        
        <ion-card basicPadding *ngIf="activeTab=='courses'">
          <ion-card-header>
            <ion-card-title>{{'page_account.my_courses' | translate}}</ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <ion-card basicPadding listCard borderSecondary borderRadius16 pointer *ngFor="let course of courses$ | async | sortBy : 1 : 'startdate' | filterKey : 'status' : 'finished'" flex center-ver fullwidth (click)="nav.go('course/'+course.courseId)">
              <ion-card-title>{{ course.title }}</ion-card-title>
              <span class="spacer"></span>
              <fa-icon [icon]="icon.get('faTrashAlt')" trash noteIcon (click)="deleteCourse($event,course)"></fa-icon>
            </ion-card>
          </ion-card-content>
        </ion-card>
        
        <ion-card noPadding style="background:none;" *ngIf="activeTab=='conversations'">

            <ion-row>
                <ion-col [size]="helper.cardSizeSmall" *ngFor="let conversation of conversations$ | async | sortBy : 1 : 'timestamp' | filterKey : 'closed' : 'notEmpty';let i = index">
                  
                  <ion-card *ngIf="!media.smallDevice" [id]="'case_card'+i" noPadding pointer fullheight class="caseItem" (click)="openConversation(conversation)">
                      <ion-card-content noPadding fullHeight>
                          <div backgroundImage class="avatarImage" *ngIf="conversation.photo" [ngStyle]="{'background-image': 'url(' + conversation.photo + ')'}"></div>
                          <div backgroundImage class="avatarImage" *ngIf="!conversation.photo" [ngStyle]="{'background-image': 'url(assets/img/default_avatar.png)'}"></div>
                          <div class="shareButtonCase" pointer (click)="media.shareCase(conversation,$event)">
                              <ion-icon name="share-outline" font-22 *ngIf="this.media.isAppleDevice"></ion-icon>
                              <ion-icon name="share-social-outline" font-22 *ngIf="!this.media.isAppleDevice"></ion-icon>
                          </div>
                          <div class="deleteButtonCase" pointer (click)="deleteConversation($event,conversation)">
                            <fa-icon font-18 [icon]="icon.get('faTrashAlt')" trash></fa-icon>
                        </div>
                          <div flex center center-ver center-hor style="height:calc(100% - 275px)">
                              <ion-card-header>
                                  <ion-card-title font-18 weight600>{{conversation.title}}</ion-card-title>
                                  <ion-card-subtitle font-14 weight400>{{ helper.showLocalDate(conversation.timestamp,translate.instant('date_formats.longDateTime'),0,true) }}</ion-card-subtitle>
                              </ion-card-header>
                          </div>
                          <div center flex center-ver center-hor>
                              <ion-button class="saveButton cardButton" fill="outline" size="small" (click)="openConversation(conversation,$event)">{{'buttons.watch' | translate}}</ion-button>
                          </div>
                      </ion-card-content>
                  </ion-card>
  
                  <ion-card *ngIf="media.smallDevice" class="caseItemSm" [id]="'case_card'+i" noMargin basicPadding pointer flex align-top style="border-radius:16px;width:calc(100% - 10px)" (click)="openConversation(conversation)">
                    <div style="width:100px;">
                        <div backgroundImage fullwidth fullheight class="avatarImage avatarSmall" *ngIf="conversation.photo" [ngStyle]="{'background-image': 'url(' + conversation.photo + ')'}"></div>
                        <div backgroundImage fullwidth fullheight class="avatarImage avatarSmall" *ngIf="!conversation.photo" [ngStyle]="{'background-image': 'url(assets/img/default_avatar.png)'}"></div>
                    </div>
                    
                    <div flex flex-column fullwidth style="height: 135px;">
                        <ion-card-header style="padding:0px 10px;flex-direction:column" >
                            <ion-card-title style="text-transform:none;color:var(--ion-color-secondary)" font-18 weight600 text-secondary>{{conversation.title}}</ion-card-title>
                            <ion-card-subtitle style="text-transform:none;margin-top:10px;" font-14 weight500>{{helper.showLocalDate(conversation.timestamp,translate.instant('date_formats.longDateTime'),0,true) }}</ion-card-subtitle>
                        </ion-card-header>
                        <span class="spacer"></span>
                        <div flex center-ver fullwidth class="arrowDiv">
                            <fa-icon removeIcon [icon]="icon.get('faTrashAlt')" titleIcon font-24 trash (click)="deleteConversation($event,conversation)"></fa-icon>
                            <span class="spacer"></span>
                            <span font-18 text-secondary weight600 relative style="top:-2px">{{'buttons.watch' | translate}}</span>
                            <fa-icon font-24 titleIcon [icon]="icon.get('faArrowRight')"></fa-icon>
                        </div>
                    </div>
                  </ion-card>
                </ion-col>
            </ion-row>
        </ion-card>


        <!-- <ion-card basicPadding *ngIf="activeTab=='subscriptions'">
          <ion-card-header>
            <ion-card-title>{{'page_account.my_subscription' | translate}}</ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <ion-row>
              <ion-col size="4" *ngFor="let product of subscriptionsStripe">
                <ion-button class="saveButton" (click)="buy(product)">
                    {{product.name}}
                </ion-button>
              </ion-col>
                
            </ion-row>

            <ion-list>
              <ion-item detail="false" *ngFor="let subscription of subscriptions$ | async ">
                <ion-label>
                  <h2>{{ subscription.type | titlecase }} ({{ subscription.period }})</h2>
                  <p>Status: {{ subscription.status }}</p>
                  <p>Start: {{ subscription.startDate?.toDate() | date }}</p>
                  <p>Eind: {{ subscription.endDate?.toDate() | date }}</p>
                </ion-label>
              </ion-item>
            </ion-list>
          </ion-card-content>
        </ion-card> -->

        <ion-card basicPadding *ngIf="activeTab=='credits'">

          <ion-card borderPrimary borderRadius16 pointer (click)="showInfoCredits=!showInfoCredits">
            <ion-card-header>
              <ion-card-title flex center-ver fullwidth>
                {{'page_account.credits_how_title' | translate}}
                <div class="spacer"></div>
                <fa-icon [icon]="icon.get('faChevronDown')" [ngStyle]="{'transform': showInfoCredits ? 'rotate(180deg)' : 'rotate(0deg)'}" style="transition: all 0.3s ease-in-out;"></fa-icon>
              </ion-card-title>
            </ion-card-header>
            <ion-card-content *ngIf="showInfoCredits">
              <div font-16 weight400 [innerHtml]="translate.instant('page_account.credits_how_text')"></div>
              <!-- <div style="max-width:300px" fullwidth marginTop>
                <div font-16 weight700 uppercase text-primary>Credits per optie</div>
                <ion-list>
                  <ion-item>
                    <ion-label>Optie</ion-label>
                    <ion-label slot="end">Credits</ion-label>
                  </ion-item>
                  <ion-item>
                    <ion-label>Interactie</ion-label>
                    <ion-label slot="end">12</ion-label>
                  </ion-item>
                  <ion-item>
                    <ion-label>Suggesties</ion-label>
                    <ion-label slot="end">4</ion-label>
                  </ion-item>
                  <ion-item>
                    <ion-label>Fact-checker</ion-label>
                    <ion-label slot="end">7</ion-label>
                  </ion-item>
                  <ion-item>
                    <ion-label>Achtergrond informatie</ion-label>
                    <ion-label slot="end">4</ion-label>
                  </ion-item>
                  <ion-item>
                    <ion-label>Gespreks analyse</ion-label>
                    <ion-label slot="end">12</ion-label>
                  </ion-item>
                  <ion-item>
                    <ion-label>Voice to text</ion-label>
                    <ion-label slot="end">2</ion-label>   
                  </ion-item>
                </ion-list>
              </div> -->
            </ion-card-content>
          </ion-card>
          
          <ion-card-header marginTop>
            <ion-card-title>{{'page_account.credits_open' | translate}}: 
              <div inline-block marginLeft font-20 weight700 uppercase text-secondary *ngIf="auth.credits.total&&!auth.credits_unlimited_type">{{auth.credits.total}}</div>
              <div inline-block marginLeft font-20 weight700 uppercase text-secondary *ngIf="auth.credits.total&&auth.credits_unlimited_type">{{'page_account.credits_unlimited_chat' | translate}}</div>
              <div inline-block marginLeft font-20 weight700 uppercase text-secondary *ngIf="!auth.credits.total">{{'page_account.no_credits' | translate}}</div>

            </ion-card-title>
          </ion-card-header>
          <ion-card-header *ngIf="auth.creditsList?.length">
            <ion-card-title>{{'page_account.your_credits' | translate}}: </ion-card-title>
          </ion-card-header>
          <ion-row>
            <div fullwidth>
              <ion-card basicPadding listCard borderPrimary borderRadius16 pointer basicMargin *ngFor="let credits of auth.creditsList | sortBy : -1 : 'expires'">
                <div flex center-ver fullwidth>
                  <div font-18 weight600 text-primary>{{'page_account.credits_source_'+credits.source | translate}}</div>
                  <div class="spacer"></div>
                  <div font-14 weight400 align-right>{{'page_account.credits_expire' | translate}}: {{helper.showLocalDate(credits.expires,'',0,true)}}</div>
                </div>
                <div flex center-ver fullwidth *ngIf="credits.type!='unlimited-chat'">
                  <div font-18 weight600>{{'page_account.credits'| translate}}:</div>
                  <div class="spacer"></div>
                  <div><span font-18 weight600>{{credits.total}}</span> / <span>{{credits.amount}}</span></div>
                </div>
                <div flex center-ver fullwidth *ngIf="credits.type=='unlimited-chat'">
                  <div font-18 weight600>{{'page_account.credits'| translate}}:</div>
                  <div class="spacer"></div>
                  <div font-18 weight600>{{'page_account.credits_unlimited_chat' | translate}}</div>
                </div>
              </ion-card>
            </div>
          </ion-row>
          <ion-card-header>
            <ion-card-title>{{'page_account.more_credits' | translate}}</ion-card-title>
          </ion-card-header>
          <ion-row>
            
            <ion-col [size]="helper.cardSizeSmall" *ngFor="let product of accountService.products | sortBy : -1 : 'credits'">
              
              <ion-card noPadding pointer class="caseItem" (click)="accountService.showProductInfo(product)">
                <ion-card-content noPadding fullHeight>
                    <div backgroundImage class="avatarImage" [ngStyle]="{'background-image': 'url(assets/img/credits.webp)'}">
                      <div class="title">{{product.title}}</div>
                    </div>
                    <div flex center center-ver center-hor style="height:calc(100% - 275px)">
                        <ion-card-header>
                            <ion-card-title font-24 weight600>{{product.credits}} {{'page_account.credits' | translate}}</ion-card-title>
                            <ion-card-subtitle font-14 weight600 text-secondary>{{product.conversations}}<br>{{'page_account.credits_conversations' | translate}}</ion-card-subtitle>
                        </ion-card-header>
                    </div>
                    <div center flex center-ver center-hor marginBottom *ngIf="product.prices?.length">
                        <ion-button class="saveButton cardButton" fill="outline" size="small" font-20>{{(product.prices[0].unit_amount / 100) | currency : (product.prices[0].currency | uppercase) }}</ion-button>
                    </div>
                </ion-card-content>
              </ion-card>
              
            </ion-col>

            <!-- <ion-col [size]="media.screenSize=='md' ? 6 : 12" *ngFor="let product of subscriptionsStripe | filterKey : 'title' : 'unlimited'">
              
              <ion-card noPadding pointer class="caseItem" (click)="showProductInfo(product)">
                <ion-card-content noPadding fullHeight>
                    <div backgroundImage class="avatarImage" [ngStyle]="{'background-image': 'url(assets/img/credits.webp)'}">
                      <div class="title">{{product.title}}</div>
                    </div>
                    <div flex center center-ver center-hor style="height:calc(100% - 275px)">
                        <ion-card-header>
                            <ion-card-title font-24 weight600>{{'page_account.credits_unlimited_chat' | translate}}</ion-card-title>
                            <ion-card-subtitle font-14 weight600 text-secondary>Onbeperkt<br>Uitgebreide gesprekken</ion-card-subtitle>
                        </ion-card-header>
                    </div>
                    <div center flex center-ver center-hor marginBottom *ngIf="product.prices?.length">
                        <ion-button class="saveButton cardButton" fill="outline" size="small" font-20>{{(product.prices[0].unit_amount / 100) | currency : (product.prices[0].currency | uppercase) }}</ion-button>
                    </div>
                </ion-card-content>
            </ion-card>
              
            </ion-col> -->

            <!-- <ion-col [size]="helper.cardSizeSmall" *ngFor="let product of subscriptionsStripe | filterKey : 'title' : 'unlimited'">
              <ion-card noPadding center class="creditsCard creditsCardUnlimited" *ngIf="product.prices?.length">
                <div class="miniHeader">{{product.title}}</div>
                <div class="header">{{(product.prices[0].unit_amount / 100) | currency : (product.prices[0].currency | uppercase) }}</div>
                <div class="logo">
                  <img src="assets/icon/alicialabs_logo.png" alt="">
                </div>
                <div class="credits">{{'page_account.credits_unlimited_chat' | translate}}</div>
                <div class="list">
                  <ion-list>
                    <ion-item>
                      <ion-label>
                        <p>Onbeperkt aantal gesprekken</p>
                      </ion-label>
                    </ion-item>
                    <ion-item detail="false" >
                      <ion-label>
                        <p>Geldig voor 1 jaar</p>
                      </ion-label>
                    </ion-item>
                    <ion-item detail="false" >
                      <ion-label>
                        <p>Persoonlijk dashboard</p>
                      </ion-label>
                    </ion-item>
                  </ion-list>
                </div>
                <div class="buttons" marginBottom>
                  <ion-button class="saveButton" (click)="buy(product)">
                      {{'page_account.buy_now' | translate}}
                  </ion-button>
                </div>
              </ion-card>
            </ion-col> -->

            <ion-col size="12" marginTop>
              <ion-button fill="clear" color="medium" class="saveButton" (click)="showOfferCode=!showOfferCode">
                <fa-icon [icon]="icon.get('faGift')" font-18></fa-icon>
                <span marginLeft font-18 weight600>{{'page_register.show_offerCode' | translate}}</span>
              </ion-button>

              <ion-item detail="false" lines="none" listCard *ngIf="showOfferCode">
                  <ion-label position="stacked">{{'page_register.offerCode' | translate}}</ion-label>
                  <ion-input style="margin-left:10px" weight700 type="text" [(ngModel)]="offerCode">
                  </ion-input>
                  <fa-icon relative style="top:15px" font-20 slot="end" [icon]="icon.get('faTimes')" (click)="offerCode = ''"></fa-icon>
                  <ion-button slot="end" class="saveButton" style="min-height:24px" size="small" fill="solid" (click)="checkOffer()">{{'buttons.submit' | translate}}</ion-button>
              </ion-item>

            </ion-col>


          </ion-row>
            
        </ion-card>

      </ion-col>
    </ion-row>
  </ion-grid>
</main>